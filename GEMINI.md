# Project Context: PowerTrader AI

## 1. Project Overview
PowerTrader AI is a local, multi-process algorithmic trading system. It uses a "Memory-based" pattern matching algorithm to predict price movements on KuCoin and executes trades on Robinhood Crypto.
- **Architecture:** A central GUI (`pt_hub.py`) orchestrates three independent subprocesses (`thinker`, `trader`, `trainer`).
- **Communication:** **File-based IPC.** Scripts communicate by reading/writing JSON and TXT files in specific "coin folders" (e.g., `./BTC/long_dca_signal.txt`).

## 2. Component Roles
* **`pt_hub.py` (The GUI):**
    * Built with `tkinter`.
    * Visualizes data by reading state files (e.g., `trader_status.json`, `trade_history.jsonl`).
    * Manages subprocess lifecycles (Start/Stop).
* **`pt_thinker.py` (The Brain):**
    * Fetches market data via `kucoin-python`.
    * Uses a custom "Memory" algorithm (comparing current candles to `memories_*.txt`).
    * **Output:** Writes signals to `long_dca_signal.txt` / `short_dca_signal.txt` and price bounds to `low_bound_prices.html`.
* **`pt_trader.py` (The Execution):**
    * Executes trades on Robinhood via raw API calls (`requests` + `cryptography` for signing).
    * **Input:** Reads signals generated by `pt_thinker.py`.
    * **Logic:** Manages DCA (Dollar Cost Averaging) stages, Trailing Profit Margins, and position sizing.
* **`pt_trainer.py` (The Teacher):**
    * Iteratively processes historical data to generate/refine the "Memory" files (`memories_*.txt`, `memory_weights_*.txt`).

## 3. Tech Stack & Libraries
* **Core:** Python 3.10+
* **GUI:** `tkinter`, `matplotlib` (embedded charts).
* **Network:** `requests` (Robinhood API), `kucoin-python` (Market Data).
* **Security:** `cryptography`, `PyNaCl`, `base64` (Ed25519 signing for Robinhood).
* **System:** `psutil` (process management), `subprocess`.
* **Utils:** `colorama` (CLI logs), `json` (data storage).

## 4. Coding Standards & Constraints

### File System & IPC
* **Relative Paths:** All file I/O must use absolute paths derived from `os.path.dirname(__file__)` or specific coin folders.
* **Atomic Writes:** When writing status files (JSON), write to a `.tmp` file first and then `os.replace` to prevent race conditions (readers getting half-written files).
* **Folder Structure:**
    * `./hub_data/`: Shared data for the GUI (`trader_status.json`, `pnl_ledger.json`).
    * `./BTC/` (or `./ETH/`): Coin-specific "Neural" data (`long_dca_signal.txt`, `memory.json`).

### Networking & API
* **Robinhood:** Use the `CryptoAPITrading` class in `pt_trader.py`. Sign requests using Ed25519 headers (`x-api-key`, `x-timestamp`, `x-signature`).
* **KuCoin:** Use `kucoin.client.Market` for fetching k-lines. Handle `requests.exceptions` gracefully with retries.

### Error Handling
* **Non-Blocking:** Subprocesses must never crash the Hub. Use `try/except` blocks in main loops.
* **Logging:** Use `PrintException()` pattern (as seen in `pt_thinker.py`) to print stack traces to stdout/stderr, which the Hub captures and displays in the "Live Output" pane.

## 5. Key File Patterns
* **`long_dca_signal.txt`**: Integer (0-7). 0 = No Signal. 4+ = Neural buy signal.
* **`trader_status.json`**: Real-time snapshot of portfolio and active positions for the GUI.
* **`r_key.txt` / `r_secret.txt`**: Robinhood API credentials (never commit these!).

## 6. Development Priorities
1.  **Stability:** The `hub` must remain responsive even if a subprocess hangs.
2.  **Data Integrity:** Ensure signals read from files are fresh (check `os.path.getmtime`).
3.  **Visualization:** GUI updates should be efficient (throttle chart refreshes to avoid freezing UI).
